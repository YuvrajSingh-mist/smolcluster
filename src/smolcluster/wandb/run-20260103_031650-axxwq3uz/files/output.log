[Leader] Accepted connection from ('127.0.0.1', 59085)
[Leader] Handling worker at ('127.0.0.1', 59085)
2026-01-03 03:17:58,625 - Server - INFO - Handling worker at ('127.0.0.1', 59085)
[Leader] Accepted connection from ('127.0.0.1', 59097)
[Leader] Handling worker at ('127.0.0.1', 59097)
2026-01-03 03:18:23,046 - Server - INFO - Handling worker at ('127.0.0.1', 59097)

[Leader] Starting training for 10 epochs.
[Leader] Starting epoch 1/10
[Leader] Epoch 1, Batch 0: Received gradients from 1/2 workers.
[Leader] Waiting for more gradients for batch 0...
[Leader] Received gradients from worker ('127.0.0.1', 59085) with ID 0 for batch 0[Leader] Received gradients from worker ('127.0.0.1', 59097) with ID 1 for batch 0[Leader] Storing gradients from worker 0 for batch 0[Leader] Storing gradients from worker 1 for batch 0
2026-01-03 03:18:23,547 - Server - INFO - Received gradients from worker ('127.0.0.1', 59085) with ID 0 for batch 0
2026-01-03 03:18:23,547 - Server - INFO - Received gradients from worker ('127.0.0.1', 59097) with ID 1 for batch 0
2026-01-03 03:18:23,548 - Server - INFO - Storing gradients from worker 0 for batch 0
[Leader] Epoch 1, Batch 0: Received gradients from 1/2 workers.
2026-01-03 03:18:23,548 - Server - INFO - Storing gradients from worker 1 for batch 0
[Leader] Epoch 1, Batch 0: Received gradients from 2/2 workers.
Traceback (most recent call last):
  File "/Users/yuvrajsingh9886/Desktop/smolcluster/src/smolcluster/./server.py", line 327, in <module>
    main()
    ~~~~^^
  File "/Users/yuvrajsingh9886/Desktop/smolcluster/src/smolcluster/./server.py", line 262, in main
    leader_reduced, worker_reduced = all_reduce(
                                     ~~~~~~~~~~^
        grads_received[batch_idx], len(grads_received[batch_idx])
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/yuvrajsingh9886/Desktop/smolcluster/src/smolcluster/./server.py", line 157, in all_reduce
    for worker_id in grads_dict:
                     ^^^^^^^^^^
RuntimeError: dictionary changed size during iteration
Traceback (most recent call last):
  File "/opt/miniconda3/lib/python3.13/threading.py", line 1540, in _shutdown
    _thread_shutdown()
KeyboardInterrupt:
